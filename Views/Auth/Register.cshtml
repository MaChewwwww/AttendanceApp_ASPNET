@{
    Layout = "_AuthLayout";
    ViewData["Title"] = "Register";
}

<div class="p-6 h-full">
    <!-- Progress Indicator -->
    <div class="mb-6">
        <div class="flex items-center justify-center space-x-2">
            <div class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold">1</div>
            <div class="w-12 h-1 bg-gray-300 rounded"></div>
            <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 text-xs font-semibold">2</div>
            <div class="w-12 h-1 bg-gray-300 rounded"></div>
            <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 text-xs font-semibold">3</div>
            <div class="w-12 h-1 bg-gray-300 rounded"></div>
            <div class="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-500 text-xs font-semibold">4</div>
        </div>
        <div class="text-center mt-2 text-xs text-gray-600">Step 1: Personal Information</div>
    </div>

    <!-- Validation Messages -->
    <div id="validationMessages" class="hidden mb-4 rounded-lg bg-red-50 border border-red-200 p-3 animate-slide-down">
        <div class="flex items-center">
            <svg class="w-4 h-4 text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
            </svg>
            <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
        </div>
        <ul id="errorList" class="mt-2 text-xs text-red-700 list-disc pl-5"></ul>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="hidden mb-4 rounded-lg bg-green-50 border border-green-200 p-3 animate-slide-down">
        <div class="flex items-center">
            <svg class="w-4 h-4 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <p class="text-sm font-medium text-green-800">Form validation successful!</p>
        </div>
    </div>

    <form id="registrationForm" class="space-y-3">
        <!-- Personal Information Section -->
        <div class="bg-gray-50 rounded-lg p-3">
            <h3 class="text-sm font-semibold text-gray-800 mb-3 flex items-center">
                <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                </svg>
                Personal Information
            </h3>
            <div class="grid grid-cols-2 gap-3">
                <!-- First Name -->
                <div class="group">
                    <label for="first_name" class="block text-xs font-medium text-gray-700 mb-1">
                        First Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="first_name" name="first_name" placeholder="First name" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400">
                </div>

                <!-- Last Name -->
                <div class="group">
                    <label for="last_name" class="block text-xs font-medium text-gray-700 mb-1">
                        Last Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="last_name" name="last_name" placeholder="Last name" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400">
                </div>
            </div>
        </div>

        <!-- Date of Birth Section -->
        <div class="bg-gray-50 rounded-lg p-3">
            <h3 class="text-sm font-semibold text-gray-800 mb-3 flex items-center">
                <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                </svg>
                Date of Birth
            </h3>
            <div class="grid grid-cols-3 gap-3">
                <div>
                    <label for="day" class="block text-xs font-medium text-gray-700 mb-1">
                        Day <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="day" name="day" placeholder="DD" min="1" max="31" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 text-center">
                </div>
                <div>
                    <label for="month" class="block text-xs font-medium text-gray-700 mb-1">
                        Month <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="month" name="month" placeholder="MM" min="1" max="12" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 text-center">
                </div>
                <div>
                    <label for="year" class="block text-xs font-medium text-gray-700 mb-1">
                        Year <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="year" name="year" placeholder="YYYY" min="1900" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 text-center">
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="bg-gray-50 rounded-lg p-3">
            <h3 class="text-sm font-semibold text-gray-800 mb-3 flex items-center">
                <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
                Contact Information
            </h3>
            <div class="space-y-3">
                <!-- Contact Number -->
                <div>
                    <label for="contact_number" class="block text-xs font-medium text-gray-700 mb-1">
                        Contact Number <span class="text-red-500">*</span>
                    </label>
                    <input type="tel" id="contact_number" name="contact_number" placeholder="09******** (11 digits)" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400">
                </div>

                <!-- Student Number -->
                <div>
                    <label for="student_number" class="block text-xs font-medium text-gray-700 mb-1">
                        Student Number <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="student_number" name="student_number" placeholder="STU123456" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400">
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="block text-xs font-medium text-gray-700 mb-1">
                        Email Address <span class="text-red-500">*</span>
                    </label>
                    <input type="email" id="email" name="email" placeholder="yourname@iskolarngbayan.pup.edu.ph" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400">
                </div>
            </div>
        </div>

        <!-- Security Section -->
        <div class="bg-gray-50 rounded-lg p-3">
            <h3 class="text-sm font-semibold text-gray-800 mb-3 flex items-center">
                <svg class="w-4 h-4 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                </svg>
                Security Information
            </h3>
            <div class="space-y-3">
                <!-- Password -->
                <div class="relative">
                    <label for="password" class="block text-xs font-medium text-gray-700 mb-1">
                        Password <span class="text-red-500">*</span>
                    </label>
                    <input type="password" id="password" name="password" placeholder="Min 6 chars, 1 upper, 1 lower, 1 special" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 pr-10">
                    <button type="button" id="togglePassword" class="absolute right-3 top-7 text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>

                <!-- Confirm Password -->
                <div class="relative">
                    <label for="confirm_password" class="block text-xs font-medium text-gray-700 mb-1">
                        Confirm Password <span class="text-red-500">*</span>
                    </label>
                    <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm your password" required
                           class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm transition-all duration-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-gray-400 pr-10">
                    <button type="button" id="toggleConfirmPassword" class="absolute right-3 top-7 text-gray-400 hover:text-gray-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Password Strength Indicator -->
            <div id="passwordStrength" class="mt-3 hidden">
                <div class="text-xs font-medium text-gray-700 mb-1">Password Strength:</div>
                <div class="flex space-x-1">
                    <div id="strength1" class="h-1.5 w-1/4 rounded bg-gray-200"></div>
                    <div id="strength2" class="h-1.5 w-1/4 rounded bg-gray-200"></div>
                    <div id="strength3" class="h-1.5 w-1/4 rounded bg-gray-200"></div>
                    <div id="strength4" class="h-1.5 w-1/4 rounded bg-gray-200"></div>
                </div>
                <div id="strengthText" class="text-xs text-gray-600 mt-1"></div>
            </div>
        </div>

        <!-- Terms and Conditions -->
        <div class="bg-blue-50 rounded-lg p-3 border border-blue-200">
            <div class="flex items-start">
                <input type="checkbox" id="terms" name="terms" required
                       class="mt-0.5 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 transition-colors"
                       style="accent-color: #2563eb;" />
                <span class="ml-3 text-xs text-gray-700 select-none">
                    I agree to the 
                    <a href="#" class="text-blue-600 hover:text-blue-800 underline font-medium terms-link">Terms and Conditions</a>
                    and 
                    <a href="#" class="text-blue-600 hover:text-blue-800 underline font-medium terms-link">Privacy Policy</a>
                    <span class="text-red-500">*</span>
                </span>
            </div>
        </div>

        <!-- Terms Modal -->
        <div id="termsModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg shadow-lg max-w-lg w-full relative flex flex-col">
                <!-- Close Icon -->
                <button id="closeTermsModal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <div class="p-6 flex-1 flex flex-col">
                    <h2 class="text-lg font-bold mb-4 text-gray-800">Terms and Conditions & Privacy Policy</h2>
                    <div class="max-h-96 overflow-y-auto text-sm text-gray-700 mb-6 flex-1">
                        <h3 class="text-lg font-bold mb-2">Terms of Use</h3>
                        <ol class="list-decimal pl-5 mb-4 space-y-2">
                            <li>
                                <strong>Acceptance of Terms</strong><br>
                                By accessing or using the Facial Recognition Attendance System Attendify, you agree to be bound by these Terms of Use. If you do not agree to these Terms, you are not authorized to access nor use the system.
                            </li>
                            <li>
                                <strong>Purpose of the System</strong><br>
                                The system is developed to streamline and automate attendance tracking through facial recognition technology. It is intended solely for authorized use by organizations, administrators, and approved users for attendance monitoring and management.
                            </li>
                            <li>
                                <strong>User Responsibilities</strong><br>
                                By using the System, you agree to:
                                <ul class="list-disc pl-5">
                                    <li>Use the System only for its intended purpose and in accordance with applicable laws and regulations.</li>
                                    <li>Refrain from attempting to reverse-engineer, modify, disrupt, or misuse the System or any data it processes.</li>
                                    <li>Maintain the confidentiality of any account credentials provided to you and promptly notify us of any unauthorized use.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Intellectual Property</strong><br>
                                The System, including all software, algorithms, designs, and associated intellectual property, is owned by Attendify or its licensors. You may not copy, reproduce, distribute, or create derivative works from the System without prior written consent from Attendify.
                            </li>
                            <li>
                                <strong>Termination</strong><br>
                                Attendify reserves the right to suspend or terminate your access to the System at any time, with or without notice, if you violate these Terms or engage in unlawful or unauthorized activities.
                            </li>
                            <li>
                                <strong>Limitation of Liability</strong><br>
                                The System is provided “as is” without warranties of any kind. Attendify shall not be liable for any damages arising from the use or inability to use the System, including but not limited to system errors, data loss, or downtime.
                            </li>
                            <li>
                                <strong>Changes to Terms</strong><br>
                                We may update these Terms at any time. Continued use of the System after changes constitutes your acceptance of the revised Terms.
                            </li>
                        </ol>
                        <h3 class="text-lg font-bold mb-2">Privacy Statement</h3>
                        <ol class="list-decimal pl-5 mb-4 space-y-2">
                            <li>
                                <strong>Information We Collect</strong><br>
                                The Facial Recognition Attendance System collects the following personal information:
                                <ul class="list-disc pl-5">
                                    <li><strong>Biometric Data:</strong> Facial images or templates used for attendance tracking.</li>
                                    <li><strong>Personal Information:</strong> Name, employee ID, or other identifiers linked to attendance records.</li>
                                    <li><strong>Usage Data:</strong> Logs of system interactions, such as timestamps of attendance records.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>How We Use Your Information</strong><br>
                                We collect and use data to:
                                <ul class="list-disc pl-5">
                                    <li>Authenticate identities and record attendance.</li>
                                    <li>Enhance the System’s reliability, performance, and accuracy.</li>
                                    <li>Comply with legal obligations or organizational policies.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Data Storage and Security</strong><br>
                                All biometric data is encrypted and stored securely to prevent unauthorized access. Personal and usage data are stored with industry-standard security measures. We retain data only as long as necessary to fulfill attendance purposes or legal obligations.
                            </li>
                            <li>
                                <strong>Data Sharing</strong><br>
                                We do not share your data with third parties unless:
                                <ul class="list-disc pl-5">
                                    <li>You have given explicit consent.</li>
                                    <li>It is required by law or a valid legal request.</li>
                                    <li>It is shared with trusted service providers under strict confidentiality agreements to help operate or support the System.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Your Rights</strong><br>
                                You may have the right, in accordance with applicable laws, to:
                                <ul class="list-disc pl-5">
                                    <li>Access, review, correct, or request deletion of your personal data.</li>
                                    <li>Request information about how your data is collected and used.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Data Retention</strong><br>
                                Biometric and personal data are deleted once they are no longer needed for attendance tracking or as required by applicable law. You may request earlier deletion of your data where legally permitted.
                            </li>
                            <li>
                                <strong>Contact Us</strong><br>
                                For any questions, concerns, or requests related to these Terms or our Privacy Statement, please contact us at:<br>
                                📧 attendify.attendancesystem@gmail.com
                            </li>
                            <li>
                                <strong>Changes to Privacy Statement</strong><br>
                                This Privacy Statement may be updated periodically. Any significant changes will be communicated through the System or via other appropriate means.
                            </li>
                        </ol>
                        <div class="p-6 pt-0 border-t border-gray-200">
                            <button id="agreeTermsBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-semibold text-sm mt-4">
                                I Agree
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="pt-3">
            <button type="button" id="submitButton"
                    class="w-full rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-3 text-sm text-white font-semibold shadow-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                <span id="buttonText">Continue to Next Step</span>
                <svg id="buttonSpinner" class="hidden animate-spin -mr-1 ml-2 h-4 w-4 text-white inline" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <svg class="inline ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
            </button>
        </div>
    </form>

    <!-- Help Text -->
    <div class="mt-3 text-center">
        <p class="text-xs text-gray-600">
            Already have an account? 
            <button id="switchToLogin" class="text-blue-600 hover:text-blue-800 font-medium underline cursor-pointer">Sign in here</button>
        </p>
    </div>
</div>

@await Html.PartialAsync("_CameraModal")

<script src="~/js/register.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add switch to login functionality
        document.getElementById('switchToLogin')?.addEventListener('click', function() {
            document.getElementById('loginTab')?.click();
        });

        const termsCheckbox = document.getElementById('terms');
        const termsModal = document.getElementById('termsModal');
        const agreeTermsBtn = document.getElementById('agreeTermsBtn');
        const closeTermsModal = document.getElementById('closeTermsModal');

        // Always start unchecked
        if (termsCheckbox) termsCheckbox.checked = false;

        // Show modal on mouse click (before checkbox toggles)
        if (termsCheckbox) {
            termsCheckbox.addEventListener('mousedown', function(e) {
                if (!termsCheckbox.checked) {
                    e.preventDefault();
                    termsModal.classList.remove('hidden');
                }
            });
            // Show modal on keyboard (space/enter)
            termsCheckbox.addEventListener('keydown', function(e) {
                if ((e.key === " " || e.key === "Enter") && !termsCheckbox.checked) {
                    e.preventDefault();
                    termsModal.classList.remove('hidden');
                }
            });
        }

        // Handle "I Agree"
        if (agreeTermsBtn) {
            agreeTermsBtn.addEventListener('click', function() {
                termsCheckbox.checked = true;
                termsModal.classList.add('hidden');
                termsCheckbox.focus();
            });
        }

        // Handle close (X)
        if (closeTermsModal) {
            closeTermsModal.addEventListener('click', function() {
                termsModal.classList.add('hidden');
                termsCheckbox.checked = false;
                termsCheckbox.focus();
            });
        }

        // Optional: clicking outside modal closes it
        if (termsModal) {
            termsModal.addEventListener('click', function(e) {
                if (e.target === termsModal) {
                    termsModal.classList.add('hidden');
                    termsCheckbox.checked = false;
                    termsCheckbox.focus();
                }
            });
        }

        // Show modal when clicking Terms and Conditions or Privacy Policy links
        document.querySelectorAll('.terms-link').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const termsModal = document.getElementById('termsModal');
                if (termsModal) termsModal.classList.remove('hidden');
            });
        });
    });
</script>